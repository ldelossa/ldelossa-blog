<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=https://meyerweb.com/eric/tools/css/reset/reset.css rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2:wght@500&display=swap" rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Muli&display=swap" rel=stylesheet> <link href=github-markdown.css rel=stylesheet> <link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/zenburn.min.css rel=stylesheet> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js></script> <script src=//gc.zgo.at/count.js async data-goatcounter=https://ldelossa.goatcounter.com/count></script> <style>.layout.svelte-lybuj1{display:grid;height:100vh;width:100vw;grid-template-columns:1.5fr 6fr}.content-wrapper.svelte-lybuj1{grid-area:1/2/2/3;overflow-y:auto}.content-wrapper-full.svelte-lybuj1{grid-area:1/1/2/3}@media screen and (max-width:600px){.layout.svelte-lybuj1{display:grid;grid-template-columns:1fr}.content-wrapper.svelte-lybuj1{z-index:1}.content-wrapper-full.svelte-lybuj1{z-index:1}}.sidebar-open.svelte-posnvr{display:flex;justify-content:space-between;flex-direction:column;height:100vh;max-width:300px;min-width:275px;margin-right:1vmin;background:#4b6777;overflow-y:hidden}.sidebar-closed.svelte-posnvr{display:none}.sb-toggle-button-open.svelte-posnvr{z-index:100;outline:0;background-color:Transparent;border:none;padding:10px 12px;font-size:30px;cursor:pointer;color:#f3f8f2;font-family:Muli,cursive;position:fixed;left:0}.sb-toggle-button-open.svelte-posnvr:hover{color:#f2511b}.sb-toggle-button-closed.svelte-posnvr{z-index:100;outline:0;background-color:Transparent;border:none;padding:10px 12px;font-size:30px;cursor:pointer;color:#4b6777;font-family:Muli,cursive;position:fixed;left:0}.sb-toggle-button-closed.svelte-posnvr:hover{color:#f2511b}.author-wrapper.svelte-posnvr{display:flex;flex-direction:column;justify-content:center;margin:40px}.author.svelte-posnvr{text-align:center;font-size:2rem;color:#f3f8f2;font-family:Muli,sans-serif;letter-spacing:1px;text-shadow:2px 2px 0 rgba(0,0,0,.35),2px 2px 5px rgba(0,0,0,.5)}.console-wrapper.svelte-posnvr{display:flex;margin:20px;justify-content:center}nav.svelte-posnvr{display:flex;flex-direction:column;justify-content:space-around;flex-wrap:wrap}.icons-wrapper.svelte-posnvr{display:flex;flex-direction:column;justify-content:flex-end;padding:20px}@media screen and (max-width:600px){.sidebar-open.svelte-posnvr{-moz-box-shadow:initial;-webkit-box-shadow:initial;box-shadow:initial;max-width:initial;min-width:initial;margin-right:initial;border-right:initial;height:100vh;width:100vw}.icons-wrapper.svelte-posnvr{display:flex;grid-area:icons;flex-direction:column;justify-content:space-between}}pre.svelte-wc9ma6 code.svelte-wc9ma6{border-radius:3%;padding:8px;display:block;min-width:230px;max-width:275px;background:#333;color:#737373}.button-wrapper.svelte-n868dk{text-align:center;margin:1rem 0 1rem 0;padding:1rem 1rem 1rem 1rem}.button-ref.svelte-n868dk{text-decoration:underline;font-size:30px;color:#e9f1f7;font-family:Muli,sans-serif;letter-spacing:1px;text-shadow:2px 2px 0 rgba(0,0,0,.35),2px 2px 5px rgba(0,0,0,.5)}.button-ref.svelte-n868dk:hover{color:#f2511b;text-shadow:-1px -1px 0 rgba(242,81,27,.5),-1px -1px -5px rgba(242,81,27,.5)}.icons.svelte-13lfieo{display:flex;flex-direction:row;justify-content:space-around;flex-wrap:wrap}img.svelte-13lfieo{width:30px;height:30px}img.svelte-13lfieo:hover{-webkit-filter:drop-shadow(2px 2px 2px #222);filter:drop-shadow(2px 2px 2px #222)}.blog-wrapper.svelte-1ih628r{max-height:100vh;max-width:100vw}.markdown-body.svelte-1ih628r{min-width:100px;max-width:900px;margin:0 auto;padding:45px;color:#e9f1f7;font-family:Muli,sans-serif}@media(max-width:767px){.markdown-body.svelte-1ih628r{max-width:75%}}</style> <noscript id=sapper-head-start></noscript><title>Building A Home Lab With Podman - Pt2</title><noscript id=sapper-head-end></noscript> <link href=/client/21d5f7fc0374dd879b15/main.js rel=preload as=script><link href=/client/21d5f7fc0374dd879b15/blog_$slug.2.js rel=preload as=script></head> <body> <div id=sapper> <div class="svelte-lybuj1 layout"><button class="svelte-posnvr sb-toggle-button-closed">☰</button> <div class="svelte-posnvr sidebar-closed"><div class="svelte-posnvr author-wrapper"><p class="svelte-posnvr author">Louis DeLosSantos<p><div class="svelte-posnvr console-wrapper"><pre class=svelte-wc9ma6><code class=svelte-wc9ma6>❯ tree ./ldelossa 
├── hardware
├── linux
├── music
└── software
❯ <span id=cursor>▊</span></code></pre></div></div> <nav class=svelte-posnvr><div class="svelte-n868dk button-wrapper"><a href=about class="svelte-n868dk button-ref">about</a></div> <div class="svelte-n868dk button-wrapper"><a href=resume class="svelte-n868dk button-ref">resume</a></div> <div class="svelte-n868dk button-wrapper"><a href=projects class="svelte-n868dk button-ref">projects</a></div> <div class="svelte-n868dk button-wrapper"><a href=blog class="svelte-n868dk button-ref">blog</a></div></nav> <div class="svelte-posnvr icons-wrapper"><div class="svelte-13lfieo icons"><a href=https://www.linkedin.com/in/louisdelossantos/ target=_blank><img alt="linkedin icon" class=svelte-13lfieo src=linkedin.svg></a> <a href=https://github.com/ldelossa target=_blank><img alt="github icon" class=svelte-13lfieo src=github.svg></a> <a href=https://twitter.com/ldelossa_ld target=_blank><img alt="twitter icon" class=svelte-13lfieo src=twitter.svg></a></div></div></div> <div class="svelte-lybuj1 content-wrapper-full"> <div class="svelte-1ih628r blog-wrapper"><article class="svelte-1ih628r markdown-body"><h1>Building A Home Lab With Podman - Pt2</h1> <p>In <a href=/blog/home-network-pt1>Part 1</a> of this series I explain the desire to create a minimal home network running on containers, the stack being used to accomplish this, and how name resolution will work.</p> <p>This post will cover how services running as containers are routed.</p> <h2>Application Routing</h2> <p>While it's possible to port-forward every application container running on "ct-host" an issue exists with this approach. DNS alone is not capable of routing hostnames to particular ports. In other words asking DNS to “map x.ldelossa.net => 192.168.1.100:8080” is not possible.</p> <p>An application routing mechanism is required for this.</p> <pre class=hljs><code>         +-----------------------------------------------------------------------+
         |container network                                                      |
         |  10.89.0.0/24                                                         |
         |                                                    +------------+     |
         |                               +--------------------> Prometheus |     |
         |                               |                    +------------+     |
         |                               |                         :80           |
         |                               |                          ^            |
         |                               |                          |            |
         |                           +---+-----+                    |            |
         |   +-----------+           |         |              +-----+------+     |
         +---+  CoreDNS  &lt;-----------+ CT-Host +--------------> App Router +-----+
             +-----------+           |         |              +------------+
           192.168.185.10:53         +---------+             192.168.185.10:80
                   ^                                                ^
                   |                                                |
                   |                                                |
                   |                +-----------+                   |
                   |                |           |                   |
                   +----------------+Workstation+-------------------+
                DNS Query           |           |              Route Mapping
prom.ldelossa.net => 192.168.185.10 +-----------+   prom.ldelossa.net => prometheus:80
</code></pre> <p>In the following diagram:</p> <ul> <li>A workstation makes a request for "prom.ldelossa.net"</li> <li>Our CoreDNS container answers the request with the ip address of "ct-host"</li> <li>Our app router is listening on port 80 and 443, the default ports a web browser will use when connecting to a web address.</li> <li>When the app router receives the request for the hostname "prom.ldelossa.net" it will forward this to the prometheus container running inside the container network.</li> <li>The request will be routed back through the app router and returned to the Workstation.</li> </ul> <p>The app router will also provide a redirection mechanism allowing hostnames to be mapped to forwarded ports on "ct-host".</p> <h2>Traefik</h2> <p>Traefik will be the application routing mechanism.</p> <p>Personally, I don't have any experience running Traefik in production and this post isn't necessarily a plug for the application.</p> <p>However, it uses a modern configuration syntax, provides path routing and redirecting, has a pretty good UI, and comprehendable documentation.</p> <p>Traefik being written in Go is an added benefit as playing with Go projects help me design my own in the long run.</p> <h3>Configuration</h3> <p>It won't do much good echoing the already great documentation at <a href=https://docs.containo.us/ >Traefik's</a> site. If you are interested in using Traefik check out their documentation.</p> <p>The following shows this lab's configuration.</p> <p>static configuration:</p> <pre class=hljs><code><span class=hljs-section>[api]</span>
  <span class=hljs-attr>insecure</span> = <span class=hljs-literal>true</span>
  <span class=hljs-attr>dashboard</span> = <span class=hljs-literal>true</span>
  <span class=hljs-attr>debug</span> = <span class=hljs-literal>true</span>

<span class=hljs-section>[entryPoints]</span>
  <span class=hljs-section>[entryPoints.web]</span>
    <span class=hljs-attr>address</span> = <span class=hljs-string>":80"</span>

<span class=hljs-section>[providers]</span>
  <span class=hljs-section>[providers.file]</span>
    <span class=hljs-attr>filename</span> = <span class=hljs-string>"/etc/traefik/dyn.toml"</span>
    <span class=hljs-attr>watch</span> = <span class=hljs-literal>true</span>
</code></pre> <p>dynamic configuration:</p> <pre class=hljs><code><span class=hljs-section>[http]</span>
  <span class=hljs-section>[http.routers]</span>
    <span class=hljs-section>[http.routers.prom]</span>
      <span class=hljs-attr>rule</span> = <span class=hljs-string>"Host(`prom.ldelossa.net`)"</span>
      <span class=hljs-attr>service</span> = <span class=hljs-string>"prom"</span>

    <span class=hljs-section>[http.routers.ct-host]</span>
      <span class=hljs-attr>rule</span> = <span class=hljs-string>"Host(`ct-host.ldelossa.net`)"</span>
      <span class=hljs-attr>middlewares</span> = [<span class=hljs-string>"netdata-redirect"</span>]
      <span class=hljs-attr>service</span> = <span class=hljs-string>"dummy"</span>

    <span class=hljs-section>[http.routers.traefik]</span>
      <span class=hljs-attr>rule</span> = <span class=hljs-string>"Host(`traefik.ldelossa.net`)"</span>
      <span class=hljs-attr>middlewares</span> = [<span class=hljs-string>"traefik-redirect"</span>]
      <span class=hljs-attr>service</span> = <span class=hljs-string>"dummy"</span>

  <span class=hljs-section>[http.middleware]</span>
    <span class=hljs-section>[http.middlewares.netdata-redirect.redirectRegex]</span>
      <span class=hljs-attr>regex</span> = <span class=hljs-string>"^http://ct-host.ldelossa.net(.*)"</span>
      <span class=hljs-attr>replacement</span> = <span class=hljs-string>"http://ct-host.ldelossa.net:19999"</span>

    <span class=hljs-section>[http.middlewares.traefik-redirect.redirectRegex]</span>
      <span class=hljs-attr>regex</span> = <span class=hljs-string>"^http://traefik.ldelossa.net(.*)"</span>
      <span class=hljs-attr>replacement</span> = <span class=hljs-string>"http://traefik.ldelossa.net:8080"</span>

  <span class=hljs-section>[http.services]</span>
    <span class=hljs-section>[http.services.dummy.loadBalancer]</span>
    <span class=hljs-section>[http.services.prom.loadBalancer]</span>
      <span class=hljs-section>[[http.services.prom.loadBalancer.servers]]</span>
        <span class=hljs-attr>url</span> = <span class=hljs-string>"http://prom:9090"</span>
</code></pre> <p>Traefik is split into two configs: static and dynamic.</p> <p>The static configuration sets up a listening socket on port :80 and this port is exposed on "ct-host". The dynamic configuration that Traefik will watch during runtime is defined as well.</p> <p>Dynamic configuration defines our routers, middleware, and services. Hostname routing rules are defined mapping "prom.ldelossa.net" to the "service" prom. A "service" will forward traffic to the specified address, in this case the prometheus container.</p> <p>Middleware features are used to redirect requests for "ct-host.ldelossa.net" and "traefik.ldelossa.net" to ports forwarded on "ct-host". A dummy "service" is created for the redirection as no traffic will be forwarded.</p> <h2>Deployment</h2> <p>The Traefik container is deployed in a container using Podman and is managed via Systemd in the same fashion explained in part 1 of this series.</p> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> podman run -dt --network ct-host --name traefik -p 192.168.185.10:8080:8080 -p 192.168.185.10:80:80 -v /etc/containers/etc.d/traefik:/etc/traefik traefik:latest</span>
</code></pre> <p>Make note that pots 8080 and 80 are exposed on "ct-host" directly, allowing devices on the local lan to access. The configuration files are also mapped from the host allowing for easy maintenance from "ct-host".</p> <h2>Conclusion</h2> <p>By introducing appliation routing into the lab several goals are achieved.</p> <ul> <li>Containers do not need to expose ports on the local lan to be accessed.</li> <li>Containers can be accessed by a hostname.</li> <li>Hostnames can be redirected to containers exposed directly on "ct-host".</li> </ul> </article></div></div></div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{article:{date:"2020-07-03",title:"Building A Home Lab With Podman - Pt2",desc:"Application routing is introduced into the home lab",file:"home-network-pt2",html:"\u003Ch1\u003EBuilding A Home Lab With Podman - Pt2\u003C\u002Fh1\u003E\n\u003Cp\u003EIn \u003Ca href=\"\u002Fblog\u002Fhome-network-pt1\"\u003EPart 1\u003C\u002Fa\u003E of this series I explain the desire to create a minimal home network running on containers, the stack being used to accomplish this, and how name resolution will work.\u003C\u002Fp\u003E\n\u003Cp\u003EThis post will cover how services running as containers are routed.\u003C\u002Fp\u003E\n\u003Ch2\u003EApplication Routing\u003C\u002Fh2\u003E\n\u003Cp\u003EWhile it's possible to port-forward every application container running on &quot;ct-host&quot; an issue exists with this approach.\nDNS alone is not capable of routing hostnames to particular ports.\nIn other words asking DNS to “map x.ldelossa.net =&gt; 192.168.1.100:8080” is not possible.\u003C\u002Fp\u003E\n\u003Cp\u003EAn application routing mechanism is required for this.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E         +-----------------------------------------------------------------------+\n         |container network                                                      |\n         |  10.89.0.0\u002F24                                                         |\n         |                                                    +------------+     |\n         |                               +--------------------&gt; Prometheus |     |\n         |                               |                    +------------+     |\n         |                               |                         :80           |\n         |                               |                          ^            |\n         |                               |                          |            |\n         |                           +---+-----+                    |            |\n         |   +-----------+           |         |              +-----+------+     |\n         +---+  CoreDNS  &lt;-----------+ CT-Host +--------------&gt; App Router +-----+\n             +-----------+           |         |              +------------+\n           192.168.185.10:53         +---------+             192.168.185.10:80\n                   ^                                                ^\n                   |                                                |\n                   |                                                |\n                   |                +-----------+                   |\n                   |                |           |                   |\n                   +----------------+Workstation+-------------------+\n                DNS Query           |           |              Route Mapping\nprom.ldelossa.net =&gt; 192.168.185.10 +-----------+   prom.ldelossa.net =&gt; prometheus:80\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIn the following diagram:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EA workstation makes a request for &quot;prom.ldelossa.net&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EOur CoreDNS container answers the request with the ip address of &quot;ct-host&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EOur app router is listening on port 80 and 443, the default ports a web browser will use when connecting to a web address.\u003C\u002Fli\u003E\n\u003Cli\u003EWhen the app router receives the request for the hostname &quot;prom.ldelossa.net&quot; it will forward this to the prometheus container running inside the container network.\u003C\u002Fli\u003E\n\u003Cli\u003EThe request will be routed back through the app router and returned to the Workstation.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EThe app router will also provide a redirection mechanism allowing hostnames to be mapped to forwarded ports on &quot;ct-host&quot;.\u003C\u002Fp\u003E\n\u003Ch2\u003ETraefik\u003C\u002Fh2\u003E\n\u003Cp\u003ETraefik will be the application routing mechanism.\u003C\u002Fp\u003E\n\u003Cp\u003EPersonally, I don't have any experience running Traefik in production and this post isn't necessarily a plug for the application.\u003C\u002Fp\u003E\n\u003Cp\u003EHowever, it uses a modern configuration syntax, provides path routing and redirecting, has a pretty good UI, and comprehendable documentation.\u003C\u002Fp\u003E\n\u003Cp\u003ETraefik being written in Go is an added benefit as playing with Go projects help me design my own in the long run.\u003C\u002Fp\u003E\n\u003Ch3\u003EConfiguration\u003C\u002Fh3\u003E\n\u003Cp\u003EIt won't do much good echoing the already great documentation at \u003Ca href=\"https:\u002F\u002Fdocs.containo.us\u002F\"\u003ETraefik's\u003C\u002Fa\u003E site.\nIf you are interested in using Traefik check out their documentation.\u003C\u002Fp\u003E\n\u003Cp\u003EThe following shows this lab's configuration.\u003C\u002Fp\u003E\n\u003Cp\u003Estatic configuration:\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-section\"\u003E[api]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Einsecure\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Edashboard\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Edebug\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-section\"\u003E[entryPoints]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-section\"\u003E[entryPoints.web]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Eaddress\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;:80&quot;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-section\"\u003E[providers]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-section\"\u003E[providers.file]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Efilename\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;\u002Fetc\u002Ftraefik\u002Fdyn.toml&quot;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Ewatch\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Edynamic configuration:\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-section\"\u003E[http]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-section\"\u003E[http.routers]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-section\"\u003E[http.routers.prom]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Erule\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;Host(`prom.ldelossa.net`)&quot;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Eservice\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;prom&quot;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-section\"\u003E[http.routers.ct-host]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Erule\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;Host(`ct-host.ldelossa.net`)&quot;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Emiddlewares\u003C\u002Fspan\u003E = [\u003Cspan class=\"hljs-string\"\u003E&quot;netdata-redirect&quot;\u003C\u002Fspan\u003E]\n      \u003Cspan class=\"hljs-attr\"\u003Eservice\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;dummy&quot;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-section\"\u003E[http.routers.traefik]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Erule\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;Host(`traefik.ldelossa.net`)&quot;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Emiddlewares\u003C\u002Fspan\u003E = [\u003Cspan class=\"hljs-string\"\u003E&quot;traefik-redirect&quot;\u003C\u002Fspan\u003E]\n      \u003Cspan class=\"hljs-attr\"\u003Eservice\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;dummy&quot;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hljs-section\"\u003E[http.middleware]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-section\"\u003E[http.middlewares.netdata-redirect.redirectRegex]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Eregex\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;^http:\u002F\u002Fct-host.ldelossa.net(.*)&quot;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Ereplacement\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;http:\u002F\u002Fct-host.ldelossa.net:19999&quot;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-section\"\u003E[http.middlewares.traefik-redirect.redirectRegex]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Eregex\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;^http:\u002F\u002Ftraefik.ldelossa.net(.*)&quot;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-attr\"\u003Ereplacement\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;http:\u002F\u002Ftraefik.ldelossa.net:8080&quot;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hljs-section\"\u003E[http.services]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-section\"\u003E[http.services.dummy.loadBalancer]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-section\"\u003E[http.services.prom.loadBalancer]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-section\"\u003E[[http.services.prom.loadBalancer.servers]]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Eurl\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&quot;http:\u002F\u002Fprom:9090&quot;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ETraefik is split into two configs: static and dynamic.\u003C\u002Fp\u003E\n\u003Cp\u003EThe static configuration sets up a listening socket on port :80 and this port is exposed on &quot;ct-host&quot;.\nThe dynamic configuration that Traefik will watch during runtime is defined as well.\u003C\u002Fp\u003E\n\u003Cp\u003EDynamic configuration defines our routers, middleware, and services.\nHostname routing rules are defined mapping &quot;prom.ldelossa.net&quot; to the &quot;service&quot; prom.\nA &quot;service&quot; will forward traffic to the specified address, in this case the prometheus container.\u003C\u002Fp\u003E\n\u003Cp\u003EMiddleware features are used to redirect requests for &quot;ct-host.ldelossa.net&quot; and &quot;traefik.ldelossa.net&quot; to ports forwarded on &quot;ct-host&quot;.\nA dummy &quot;service&quot; is created for the redirection as no traffic will be forwarded.\u003C\u002Fp\u003E\n\u003Ch2\u003EDeployment\u003C\u002Fh2\u003E\n\u003Cp\u003EThe Traefik container is deployed in a container using Podman and is managed via Systemd in the same fashion explained in part 1 of this series.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E podman run -dt --network ct-host --name traefik -p 192.168.185.10:8080:8080 -p 192.168.185.10:80:80 -v \u002Fetc\u002Fcontainers\u002Fetc.d\u002Ftraefik:\u002Fetc\u002Ftraefik traefik:latest\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EMake note that pots 8080 and 80 are exposed on &quot;ct-host&quot; directly, allowing devices on the local lan to access.\nThe configuration files are also mapped from the host allowing for easy maintenance from &quot;ct-host&quot;.\u003C\u002Fp\u003E\n\u003Ch2\u003EConclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EBy introducing appliation routing into the lab several goals are achieved.\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EContainers do not need to expose ports on the local lan to be accessed.\u003C\u002Fli\u003E\n\u003Cli\u003EContainers can be accessed by a hostname.\u003C\u002Fli\u003E\n\u003Cli\u003EHostnames can be redirected to containers exposed directly on &quot;ct-host&quot;.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');</script><script src=/client/21d5f7fc0374dd879b15/main.js></script> 