<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=https://meyerweb.com/eric/tools/css/reset/reset.css rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2:wght@500&display=swap" rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Muli&display=swap" rel=stylesheet> <link href=github-markdown.css rel=stylesheet> <link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/zenburn.min.css rel=stylesheet> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js></script> <script src=//gc.zgo.at/count.js async data-goatcounter=https://ldelossa.goatcounter.com/count></script> <style>.layout.svelte-lybuj1{display:grid;height:100vh;width:100vw;grid-template-columns:1.5fr 6fr}.content-wrapper.svelte-lybuj1{grid-area:1/2/2/3;overflow-y:auto}.content-wrapper-full.svelte-lybuj1{grid-area:1/1/2/3}@media screen and (max-width:600px){.layout.svelte-lybuj1{display:grid;grid-template-columns:1fr}.content-wrapper.svelte-lybuj1{z-index:1}.content-wrapper-full.svelte-lybuj1{z-index:1}}.sidebar-open.svelte-posnvr{display:flex;justify-content:space-between;flex-direction:column;height:100vh;max-width:300px;min-width:275px;margin-right:1vmin;background:#4b6777;overflow-y:hidden}.sidebar-closed.svelte-posnvr{display:none}.sb-toggle-button-open.svelte-posnvr{z-index:100;outline:0;background-color:Transparent;border:none;padding:10px 12px;font-size:30px;cursor:pointer;color:#f3f8f2;font-family:Muli,cursive;position:fixed;left:0}.sb-toggle-button-open.svelte-posnvr:hover{color:#f2511b}.sb-toggle-button-closed.svelte-posnvr{z-index:100;outline:0;background-color:Transparent;border:none;padding:10px 12px;font-size:30px;cursor:pointer;color:#4b6777;font-family:Muli,cursive;position:fixed;left:0}.sb-toggle-button-closed.svelte-posnvr:hover{color:#f2511b}.author-wrapper.svelte-posnvr{display:flex;flex-direction:column;justify-content:center;margin:40px}.author.svelte-posnvr{text-align:center;font-size:2rem;color:#f3f8f2;font-family:Muli,sans-serif;letter-spacing:1px;text-shadow:2px 2px 0 rgba(0,0,0,.35),2px 2px 5px rgba(0,0,0,.5)}.console-wrapper.svelte-posnvr{display:flex;margin:20px;justify-content:center}nav.svelte-posnvr{display:flex;flex-direction:column;justify-content:space-around;flex-wrap:wrap}.icons-wrapper.svelte-posnvr{display:flex;flex-direction:column;justify-content:flex-end;padding:20px}@media screen and (max-width:600px){.sidebar-open.svelte-posnvr{-moz-box-shadow:initial;-webkit-box-shadow:initial;box-shadow:initial;max-width:initial;min-width:initial;margin-right:initial;border-right:initial;height:100vh;width:100vw}.icons-wrapper.svelte-posnvr{display:flex;grid-area:icons;flex-direction:column;justify-content:space-between}}pre.svelte-wc9ma6 code.svelte-wc9ma6{border-radius:3%;padding:8px;display:block;min-width:230px;max-width:275px;background:#333;color:#737373}.button-wrapper.svelte-n868dk{text-align:center;margin:1rem 0 1rem 0;padding:1rem 1rem 1rem 1rem}.button-ref.svelte-n868dk{text-decoration:underline;font-size:30px;color:#e9f1f7;font-family:Muli,sans-serif;letter-spacing:1px;text-shadow:2px 2px 0 rgba(0,0,0,.35),2px 2px 5px rgba(0,0,0,.5)}.button-ref.svelte-n868dk:hover{color:#f2511b;text-shadow:-1px -1px 0 rgba(242,81,27,.5),-1px -1px -5px rgba(242,81,27,.5)}.icons.svelte-13lfieo{display:flex;flex-direction:row;justify-content:space-around;flex-wrap:wrap}img.svelte-13lfieo{width:30px;height:30px}img.svelte-13lfieo:hover{-webkit-filter:drop-shadow(2px 2px 2px #222);filter:drop-shadow(2px 2px 2px #222)}.blog-wrapper.svelte-1ih628r{max-height:100vh;max-width:100vw}.markdown-body.svelte-1ih628r{min-width:100px;max-width:900px;margin:0 auto;padding:45px;color:#e9f1f7;font-family:Muli,sans-serif}@media(max-width:767px){.markdown-body.svelte-1ih628r{max-width:75%}}</style> <noscript id=sapper-head-start></noscript><title>Sequential Consistency In Practice</title><noscript id=sapper-head-end></noscript> <link href=/client/21d5f7fc0374dd879b15/main.js rel=preload as=script><link href=/client/21d5f7fc0374dd879b15/blog_$slug.2.js rel=preload as=script></head> <body> <div id=sapper> <div class="svelte-lybuj1 layout"><button class="svelte-posnvr sb-toggle-button-closed">☰</button> <div class="svelte-posnvr sidebar-closed"><div class="svelte-posnvr author-wrapper"><p class="svelte-posnvr author">Louis DeLosSantos<p><div class="svelte-posnvr console-wrapper"><pre class=svelte-wc9ma6><code class=svelte-wc9ma6>❯ tree ./ldelossa 
├── hardware
├── linux
├── music
└── software
❯ <span id=cursor>▊</span></code></pre></div></div> <nav class=svelte-posnvr><div class="svelte-n868dk button-wrapper"><a href=about class="svelte-n868dk button-ref">about</a></div> <div class="svelte-n868dk button-wrapper"><a href=resume class="svelte-n868dk button-ref">resume</a></div> <div class="svelte-n868dk button-wrapper"><a href=projects class="svelte-n868dk button-ref">projects</a></div> <div class="svelte-n868dk button-wrapper"><a href=blog class="svelte-n868dk button-ref">blog</a></div></nav> <div class="svelte-posnvr icons-wrapper"><div class="svelte-13lfieo icons"><a href=https://www.linkedin.com/in/louisdelossantos/ target=_blank><img alt="linkedin icon" src=linkedin.svg class=svelte-13lfieo></a> <a href=https://github.com/ldelossa target=_blank><img alt="github icon" src=github.svg class=svelte-13lfieo></a> <a href=https://twitter.com/ldelossa_ld target=_blank><img alt="twitter icon" src=twitter.svg class=svelte-13lfieo></a></div></div></div> <div class="svelte-lybuj1 content-wrapper-full"> <div class="svelte-1ih628r blog-wrapper"><article class="svelte-1ih628r markdown-body"><h1>Sequential Consistency In Practice</h1> <p>If you are a software engineer today concurrency is everywhere.</p> <p>On the front-end it manifests as asynchronous web requests, the backend as service-to-service communication, and in systems programming as SMP and thread safety.</p> <p>With the ubiquity of programming with the 4th dimension in mind it's valuable to expand on the building blocks.</p> <p>One of these blocks comes in the form of consistency models: specific rules which govern concurrent access to shared resources.</p> <p>With a focus on sequential consistency I'd like to show you how this model is used in practice with distributed systems.</p> <h2>Sequential Consistency</h2> <p>A conversation with an ex-colleague and friend, centered around the topic, influenced him to write up a nice explanation of sequential consistency.</p> <p>You can check out that article <a href=http://space.af/blog/2020/07/16/sequential-consistency-described-by-viotti-and-vukolic/ >here</a>, I will expand on it a bit.</p> <p>In the article referenced above it's explained that in sequential consistency a processor may view writes of other processors in any interleaving, as long as those interleavings remain in the same order.</p> <p>In short recap:</p> <pre class=hljs><code>          Proc-1   Proc-2
           W(x)     W(y)
           W(z)


  Valid:  W(x),W(z),W(y)
          W(y),W(x),W(z)
          W(x),W(y),W(z)

Invalid:  W(z),W(x),W(Y)
</code></pre> <p>The invalid interleaving is such due to Proc-1's writes happening out of Proc-1's program order.</p> <h2>Expanding On Sequential Consistency</h2> <p>While the provided definition of sequential consistency is easy to follow for two processors it gets a bit more interesting when we model a distributed system.</p> <p>In our distributed system two processes will be issuing writes to a shared register and two other processes will be observing those writes and then issuing a read.</p> <p>Each process is to obey sequential consistency.</p> <pre class=hljs><code>          Proc-1      Proc-2
           W(x)        W(y)
           W(z)


 Proc-3 Observes: W(x),W(z),W(y), R() => y

 Proc-4 Observes: W(y),W(x),W(z), R() => z
</code></pre> <p>Here we notice that Proc-3 and Proc-4 do not agree on the shared register's value, yet this is legal in sequential consistency.</p> <p>As you can imagine, in practice this is not the desired behavior.</p> <h2>Sequential Consistency In Practice</h2> <p>In order for sequential consistency to be useful in a distributed system another mechanism must be provided to ensure all processes see the <strong>same</strong> interleaving of operations.</p> <p>A slide from Martin Kleppmann's great <a href="https://www.youtube.com/watch?v=D5iCl12MuRw&feature=youtu.be">talk</a> provides one such mechanism.</p> <p><img alt="async writes in sequential system" src=/martin-klepmann-sequential-consistency.png></p> <ol> <li>Martin Kleppmann on “Sequential Consistency versus Linearizability”</li> </ol> <p>This slide shows that all writes are fed through a "transaction processor" to create one consistent interleaving of sequential operations.</p> <p>Due to network delay each processor may "lag" behind, seeing older or newer writes then the others.</p> <p>However each processor will <strong>always</strong> observe a totally ordered sequential list of operations.</p> <p>Therefore per the consistency model:</p> <ul> <li>the second processor may read the N-1 write until the network delivers write N.</li> <li>no processor who has received write N will read write N-1.</li> <li>every process will observe a sequentially consistent total ordered history of operations.</li> </ul> <h2>In Conclusion</h2> <p>In the practice of designing distributed systems sequential consistency requires some mechanism to obtain a consistent read of a shared register across processes.</p> <p>When "sequential consistency" is mentioned in regards to a distributed system what is usually being expressed is the ability for processors to "lag" behind observing changes, but eventually seeing all changes in a well defined total order.</p> <p>A secondary mechanism, whether a dedicated process, vector clocks, or fence id, must be present to enforce that each process sees a totally ordered sequence of events.</p> <hr> <p>edits:</p> <ul> <li>fix on valid sequential interleavings in first example.</li> </ul> </article></div></div></div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{article:{date:"2020-07-16",title:"Sequential Consistency In Practice",desc:"Clarification on sequential consistency and distributed system",file:"sequential-consistency-in-practice",html:"\u003Ch1\u003ESequential Consistency In Practice\u003C\u002Fh1\u003E\n\u003Cp\u003EIf you are a software engineer today concurrency is everywhere.\u003C\u002Fp\u003E\n\u003Cp\u003EOn the front-end it manifests as asynchronous web requests, the backend as service-to-service communication, and in systems programming as SMP and thread safety.\u003C\u002Fp\u003E\n\u003Cp\u003EWith the ubiquity of programming with the 4th dimension in mind it's valuable to expand on the building blocks.\u003C\u002Fp\u003E\n\u003Cp\u003EOne of these blocks comes in the form of consistency models: specific rules which govern concurrent access to shared resources.\u003C\u002Fp\u003E\n\u003Cp\u003EWith a focus on sequential consistency I'd like to show you how this model is used in practice with distributed systems.\u003C\u002Fp\u003E\n\u003Ch2\u003ESequential Consistency\u003C\u002Fh2\u003E\n\u003Cp\u003EA conversation with an ex-colleague and friend, centered around the topic, influenced him to write up a nice explanation of sequential consistency.\u003C\u002Fp\u003E\n\u003Cp\u003EYou can check out that article \u003Ca href=\"http:\u002F\u002Fspace.af\u002Fblog\u002F2020\u002F07\u002F16\u002Fsequential-consistency-described-by-viotti-and-vukolic\u002F\"\u003Ehere\u003C\u002Fa\u003E, I will expand on it a bit.\u003C\u002Fp\u003E\n\u003Cp\u003EIn the article referenced above it's explained that in sequential consistency a processor may view writes of other processors in any interleaving, as long as those interleavings remain in the same order.\u003C\u002Fp\u003E\n\u003Cp\u003EIn short recap:\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E          Proc-1   Proc-2\n           W(x)     W(y)\n           W(z)\n\n\n  Valid:  W(x),W(z),W(y)\n          W(y),W(x),W(z)\n          W(x),W(y),W(z)\n\nInvalid:  W(z),W(x),W(Y)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe invalid interleaving is such due to Proc-1's writes happening out of Proc-1's program order.\u003C\u002Fp\u003E\n\u003Ch2\u003EExpanding On Sequential Consistency\u003C\u002Fh2\u003E\n\u003Cp\u003EWhile the provided definition of sequential consistency is easy to follow for two processors it gets a bit more interesting when we model a distributed system.\u003C\u002Fp\u003E\n\u003Cp\u003EIn our distributed system two processes will be issuing writes to a shared register and two other processes will be observing those writes and then issuing a read.\u003C\u002Fp\u003E\n\u003Cp\u003EEach process is to obey sequential consistency.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E          Proc-1      Proc-2\n           W(x)        W(y)\n           W(z)\n\n\n Proc-3 Observes: W(x),W(z),W(y), R() =&gt; y\n\n Proc-4 Observes: W(y),W(x),W(z), R() =&gt; z\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EHere we notice that Proc-3 and Proc-4 do not agree on the shared register's value, yet this is legal in sequential consistency.\u003C\u002Fp\u003E\n\u003Cp\u003EAs you can imagine, in practice this is not the desired behavior.\u003C\u002Fp\u003E\n\u003Ch2\u003ESequential Consistency In Practice\u003C\u002Fh2\u003E\n\u003Cp\u003EIn order for sequential consistency to be useful in a distributed system another mechanism must be provided to ensure all processes see the \u003Cstrong\u003Esame\u003C\u002Fstrong\u003E interleaving of operations.\u003C\u002Fp\u003E\n\u003Cp\u003EA slide from Martin Kleppmann's great \u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=D5iCl12MuRw&amp;feature=youtu.be\"\u003Etalk\u003C\u002Fa\u003E provides one such mechanism.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fmartin-klepmann-sequential-consistency.png\" alt=\"async writes in sequential system\"\u003E\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EMartin Kleppmann on “Sequential Consistency versus Linearizability”\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003EThis slide shows that all writes are fed through a &quot;transaction processor&quot; to create one consistent interleaving of sequential operations.\u003C\u002Fp\u003E\n\u003Cp\u003EDue to network delay each processor may &quot;lag&quot; behind, seeing older or newer writes then the others.\u003C\u002Fp\u003E\n\u003Cp\u003EHowever each processor will \u003Cstrong\u003Ealways\u003C\u002Fstrong\u003E observe a totally ordered sequential list of operations.\u003C\u002Fp\u003E\n\u003Cp\u003ETherefore per the consistency model:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Ethe second processor may read the N-1 write until the network delivers write N.\u003C\u002Fli\u003E\n\u003Cli\u003Eno processor who has received write N will read write N-1.\u003C\u002Fli\u003E\n\u003Cli\u003Eevery process will observe a sequentially consistent total ordered history of operations.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2\u003EIn Conclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EIn the practice of designing distributed systems sequential consistency requires some mechanism to obtain a consistent read of a shared register across processes.\u003C\u002Fp\u003E\n\u003Cp\u003EWhen &quot;sequential consistency&quot; is mentioned in regards to a distributed system what is usually being expressed is the ability for processors to &quot;lag&quot; behind observing changes, but eventually seeing all changes in a well defined total order.\u003C\u002Fp\u003E\n\u003Cp\u003EA secondary mechanism, whether a dedicated process, vector clocks, or fence id, must be present to enforce that each process sees a totally ordered sequence of events.\u003C\u002Fp\u003E\n\u003Chr\u003E\n\u003Cp\u003Eedits:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Efix on valid sequential interleavings in first example.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');</script><script src=/client/21d5f7fc0374dd879b15/main.js></script> 