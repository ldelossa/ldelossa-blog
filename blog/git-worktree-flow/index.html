<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=https://meyerweb.com/eric/tools/css/reset/reset.css rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2:wght@500&display=swap" rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Muli&display=swap" rel=stylesheet> <link href=github-markdown.css rel=stylesheet> <link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/zenburn.min.css rel=stylesheet> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js></script> <script src=//gc.zgo.at/count.js async data-goatcounter=https://ldelossa.goatcounter.com/count></script> <style>.layout.svelte-lybuj1{display:grid;height:100vh;width:100vw;grid-template-columns:1.5fr 6fr}.content-wrapper.svelte-lybuj1{grid-area:1/2/2/3;overflow-y:auto}.content-wrapper-full.svelte-lybuj1{grid-area:1/1/2/3}@media screen and (max-width:600px){.layout.svelte-lybuj1{display:grid;grid-template-columns:1fr}.content-wrapper.svelte-lybuj1{z-index:1}.content-wrapper-full.svelte-lybuj1{z-index:1}}.sidebar-open.svelte-posnvr{display:flex;justify-content:space-between;flex-direction:column;height:100vh;max-width:300px;min-width:275px;margin-right:1vmin;background:#4b6777;overflow-y:hidden}.sidebar-closed.svelte-posnvr{display:none}.sb-toggle-button-open.svelte-posnvr{z-index:100;outline:0;background-color:Transparent;border:none;padding:10px 12px;font-size:30px;cursor:pointer;color:#f3f8f2;font-family:Muli,cursive;position:fixed;left:0}.sb-toggle-button-open.svelte-posnvr:hover{color:#f2511b}.sb-toggle-button-closed.svelte-posnvr{z-index:100;outline:0;background-color:Transparent;border:none;padding:10px 12px;font-size:30px;cursor:pointer;color:#4b6777;font-family:Muli,cursive;position:fixed;left:0}.sb-toggle-button-closed.svelte-posnvr:hover{color:#f2511b}.author-wrapper.svelte-posnvr{display:flex;flex-direction:column;justify-content:center;margin:40px}.author.svelte-posnvr{text-align:center;font-size:2rem;color:#f3f8f2;font-family:Muli,sans-serif;letter-spacing:1px;text-shadow:2px 2px 0 rgba(0,0,0,.35),2px 2px 5px rgba(0,0,0,.5)}.console-wrapper.svelte-posnvr{display:flex;margin:20px;justify-content:center}nav.svelte-posnvr{display:flex;flex-direction:column;justify-content:space-around;flex-wrap:wrap}.icons-wrapper.svelte-posnvr{display:flex;flex-direction:column;justify-content:flex-end;padding:20px}@media screen and (max-width:600px){.sidebar-open.svelte-posnvr{-moz-box-shadow:initial;-webkit-box-shadow:initial;box-shadow:initial;max-width:initial;min-width:initial;margin-right:initial;border-right:initial;height:100vh;width:100vw}.icons-wrapper.svelte-posnvr{display:flex;grid-area:icons;flex-direction:column;justify-content:space-between}}pre.svelte-wc9ma6 code.svelte-wc9ma6{border-radius:3%;padding:8px;display:block;min-width:230px;max-width:275px;background:#333;color:#737373}.button-wrapper.svelte-n868dk{text-align:center;margin:1rem 0 1rem 0;padding:1rem 1rem 1rem 1rem}.button-ref.svelte-n868dk{text-decoration:underline;font-size:30px;color:#e9f1f7;font-family:Muli,sans-serif;letter-spacing:1px;text-shadow:2px 2px 0 rgba(0,0,0,.35),2px 2px 5px rgba(0,0,0,.5)}.button-ref.svelte-n868dk:hover{color:#f2511b;text-shadow:-1px -1px 0 rgba(242,81,27,.5),-1px -1px -5px rgba(242,81,27,.5)}.icons.svelte-13lfieo{display:flex;flex-direction:row;justify-content:space-around;flex-wrap:wrap}img.svelte-13lfieo{width:30px;height:30px}img.svelte-13lfieo:hover{-webkit-filter:drop-shadow(2px 2px 2px #222);filter:drop-shadow(2px 2px 2px #222)}.blog-wrapper.svelte-1ih628r{max-height:100vh;max-width:100vw}.markdown-body.svelte-1ih628r{min-width:100px;max-width:900px;margin:0 auto;padding:45px;color:#e9f1f7;font-family:Muli,sans-serif}@media(max-width:767px){.markdown-body.svelte-1ih628r{max-width:75%}}</style> <noscript id=sapper-head-start></noscript><title>Git Worktree Flow</title><noscript id=sapper-head-end></noscript> <link href=/client/21d5f7fc0374dd879b15/main.js rel=preload as=script><link href=/client/21d5f7fc0374dd879b15/blog_$slug.2.js rel=preload as=script></head> <body> <div id=sapper> <div class="svelte-lybuj1 layout"><button class="svelte-posnvr sb-toggle-button-closed">☰</button> <div class="svelte-posnvr sidebar-closed"><div class="svelte-posnvr author-wrapper"><p class="svelte-posnvr author">Louis DeLosSantos<p><div class="svelte-posnvr console-wrapper"><pre class=svelte-wc9ma6><code class=svelte-wc9ma6>❯ tree ./ldelossa 
├── hardware
├── linux
├── music
└── software
❯ <span id=cursor>▊</span></code></pre></div></div> <nav class=svelte-posnvr><div class="svelte-n868dk button-wrapper"><a href=about class="svelte-n868dk button-ref">about</a></div> <div class="svelte-n868dk button-wrapper"><a href=resume class="svelte-n868dk button-ref">resume</a></div> <div class="svelte-n868dk button-wrapper"><a href=projects class="svelte-n868dk button-ref">projects</a></div> <div class="svelte-n868dk button-wrapper"><a href=blog class="svelte-n868dk button-ref">blog</a></div></nav> <div class="svelte-posnvr icons-wrapper"><div class="svelte-13lfieo icons"><a href=https://www.linkedin.com/in/louisdelossantos/ target=_blank><img alt="linkedin icon" class=svelte-13lfieo src=linkedin.svg></a> <a href=https://github.com/ldelossa target=_blank><img alt="github icon" class=svelte-13lfieo src=github.svg></a> <a href=https://twitter.com/ldelossa_ld target=_blank><img alt="twitter icon" class=svelte-13lfieo src=twitter.svg></a></div></div></div> <div class="svelte-lybuj1 content-wrapper-full"> <div class="svelte-1ih628r blog-wrapper"><article class="svelte-1ih628r markdown-body"><h1>Git Worktree Flow</h1> <p>What does death and Git have in common?</p> <p>Just like death, Git is a fact of life for engineers writing code in 2021.</p> <p>Just like death, some people fear Git while others come to terms with it.</p> <p>It's safe to say there is no avoiding Git, like there is no avoiding death, may as well make it work for us.</p> <p>In this post I will share a new workflow utilizing Git's worktree feature that has been working well for me.</p> <h1>The Scenario</h1> <p>A repository exists, a topic branch is checked out, and it is complete.</p> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git <span class=hljs-built_in>log</span></span>
commit 2d27894d5f6876ae456470f59a21bbd77184a853 (HEAD -> topic-branch)
Author: louis &lt;louis@localhost.localdomain>
Date:   Thu Aug 6 16:02:10 2020 -0400

    implement plumbing

commit 1cecb9d66c84cc007479330eec08ce74ae583cd2
Author: louis &lt;louis@localhost.localdomain>
Date:   Thu Aug 6 16:01:36 2020 -0400

    implement business logic

commit abff991f6549435d2d8140182fc37603cff1a2c4
Author: louis &lt;louis@localhost.localdomain>
Date:   Thu Aug 6 16:01:12 2020 -0400

    implement storage
</code></pre> <p>The commit structure is clean, organized, and communicates a clean trajectory of deployment.</p> <h1>Time For Review</h1> <p>A pull-request is opened against the mainline branch and a code review takes place.</p> <p>The requested changes are scattered across the clean commit history.</p> <p>A typical approach would involve making all the changes in a new commit with a comment such as "code review changes".</p> <p>This approach is reasonable but wouldn't it be nice to keep the well organized commit history designed from the beginning?</p> <h1>Worktree To The Rescue</h1> <p>A Git worktree allows the same repository to exist in multiple file system directories at once.</p> <p>The worktree repository can have any branch checked out including a new one.</p> <p>To handle the code review changes but keep our commit structure the same a worktree can be created.</p> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git worktree add ../myrepo-pr-changes</span>
Preparing worktree (new branch 'myrepo-pr-changes')
HEAD is now at 2d27894 implement plumbing
<span class=hljs-meta>
$</span><span class=bash> <span class=hljs-built_in>cd</span> ../myrepo-pr-changes</span>
</code></pre> <p>The command displayed above creates the worktree directory "myrepo-pr-changes" one directory above our current, creates the branch "myrepo-pr-changes", and check this branch out in the worktree.</p> <p>The branch "myrepo-pr-changes" will be a staging area where the changes required to pass the code review can be implemented.</p> <p>This branch allows for all the niceties of a normal topic branch, you may author commits, reset any changes which you decide are not valuable, push this branch to save your work, etc...</p> <h1>Checking Out From Worktree</h1> <p>At this stage the worktree branch "myrepo-pr-changes" has all the commits necessary to comfort your code reviewers.</p> <p>It is time to get these changes back into the topic branch.</p> <p>We can diff the code between "topic-branch" and "myrepo-pr-change" worktree branch.</p> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git diff --name-only topic-branch myrepo-pr-changes</span>
businesslogic.go
plumbing.go
store.go
</code></pre> <p>The diff shows that specific files have changed in order to appease our code reviewers.</p> <p>An interactive rebase can get these changes into the correct commits by returning to the original repository directory.</p> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> <span class=hljs-built_in>cd</span> ../myrepo        </span>
<span class=hljs-meta>
$</span><span class=bash> git rebase -i HEAD~2</span>

</code></pre> <p>Next the interactive prompt is displayed</p> <p>By specifying "edit" in one of our commits the changes present in the diff between "topic-branch" and "myrepo-pr-changes" can be checked out.</p> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git rebase -i HEAD~2</span>
Stopped at 1cecb9d...  implement business logic
You can amend the commit now, with

  git commit --amend

Once you are satisfied with your changes, run

  git rebase --continue

</code></pre> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git checkout myrepo-pr-changes -- businesslogic.go</span>
</code></pre> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git status</span>
interactive rebase in progress; onto abff991
Last command done (1 command done):
   edit 1cecb9d implement business logic
Next command to do (1 remaining command):
   pick 2d27894 implement plumbing
  (use "git rebase --edit-todo" to view and edit)
You are currently editing a commit while rebasing branch 'topic-branch' on 'abff991'.
  (use "git commit --amend" to amend the current commit)
  (use "git rebase --continue" once you are satisfied with your changes)

Changes to be committed:
  (use "git restore --staged &lt;file>..." to unstage)
    modified:   businesslogic.go
</code></pre> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git commit --amend</span>
</code></pre> <pre class=hljs><code><span class=hljs-meta>$</span><span class=bash> git rebase --<span class=hljs-built_in>continue</span></span>
Successfully rebased and updated refs/heads/topic-branch.
</code></pre> <p>In the above Git sequence the interactive rebase has paused on the "implement business logic" after choosing "edit".</p> <p>The file "businesslogic.go" from our "myrepo-pr-changes" branch is checked out immediately adding it to our staged commits.</p> <p>An amendment is made to "implement business logic" commit, incorporating the changes in "businesslogic.go".</p> <p>The rebase is told to continue and subsequently finishes.</p> <h1>Conclusion</h1> <p>Being a bit of an eccentric about commit history, a well defined workflow for keeping things neat is attractive to me.</p> <p>The use of worktrees, cross branch checkouts, and interactive rebases creates one that has worked well so far.</p> <p>I hope this post gets the gears turning for your own workflows.</p> </article></div></div></div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{article:{date:"2020-08-06",title:"Git Worktree Flow",desc:"A workflow for keeping clean commit histories",file:"git-worktree-flow",html:"\u003Ch1\u003EGit Worktree Flow\u003C\u002Fh1\u003E\n\u003Cp\u003EWhat does death and Git have in common?\u003C\u002Fp\u003E\n\u003Cp\u003EJust like death, Git is a fact of life for engineers writing code in 2021.\u003C\u002Fp\u003E\n\u003Cp\u003EJust like death, some people fear Git while others come to terms with it.\u003C\u002Fp\u003E\n\u003Cp\u003EIt's safe to say there is no avoiding Git, like there is no avoiding death, may as well make it work for us.\u003C\u002Fp\u003E\n\u003Cp\u003EIn this post I will share a new workflow utilizing Git's worktree feature that has been working well for me.\u003C\u002Fp\u003E\n\u003Ch1\u003EThe Scenario\u003C\u002Fh1\u003E\n\u003Cp\u003EA repository exists, a topic branch is checked out, and it is complete.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git \u003Cspan class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\ncommit 2d27894d5f6876ae456470f59a21bbd77184a853 (HEAD -&gt; topic-branch)\nAuthor: louis &lt;louis@localhost.localdomain&gt;\nDate:   Thu Aug 6 16:02:10 2020 -0400\n\n    implement plumbing\n\ncommit 1cecb9d66c84cc007479330eec08ce74ae583cd2\nAuthor: louis &lt;louis@localhost.localdomain&gt;\nDate:   Thu Aug 6 16:01:36 2020 -0400\n\n    implement business logic\n\ncommit abff991f6549435d2d8140182fc37603cff1a2c4\nAuthor: louis &lt;louis@localhost.localdomain&gt;\nDate:   Thu Aug 6 16:01:12 2020 -0400\n\n    implement storage\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe commit structure is clean, organized, and communicates a clean trajectory of deployment.\u003C\u002Fp\u003E\n\u003Ch1\u003ETime For Review\u003C\u002Fh1\u003E\n\u003Cp\u003EA pull-request is opened against the mainline branch and a code review takes place.\u003C\u002Fp\u003E\n\u003Cp\u003EThe requested changes are scattered across the clean commit history.\u003C\u002Fp\u003E\n\u003Cp\u003EA typical approach would involve making all the changes in a new commit with a comment such as &quot;code review changes&quot;.\u003C\u002Fp\u003E\n\u003Cp\u003EThis approach is reasonable but wouldn't it be nice to keep the well organized commit history designed from the beginning?\u003C\u002Fp\u003E\n\u003Ch1\u003EWorktree To The Rescue\u003C\u002Fh1\u003E\n\u003Cp\u003EA Git worktree allows the same repository to exist in multiple file system directories at once.\u003C\u002Fp\u003E\n\u003Cp\u003EThe worktree repository can have any branch checked out including a new one.\u003C\u002Fp\u003E\n\u003Cp\u003ETo handle the code review changes but keep our commit structure the same a worktree can be created.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git worktree add ..\u002Fmyrepo-pr-changes\u003C\u002Fspan\u003E\nPreparing worktree (new branch &#x27;myrepo-pr-changes&#x27;)\nHEAD is now at 2d27894 implement plumbing\n\u003Cspan class=\"hljs-meta\"\u003E\n$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E \u003Cspan class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ..\u002Fmyrepo-pr-changes\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe command displayed above creates the worktree directory &quot;myrepo-pr-changes&quot; one directory above our current, creates the branch &quot;myrepo-pr-changes&quot;, and check this branch out in the worktree.\u003C\u002Fp\u003E\n\u003Cp\u003EThe branch &quot;myrepo-pr-changes&quot; will be a staging area where the changes required to pass the code review can be implemented.\u003C\u002Fp\u003E\n\u003Cp\u003EThis branch allows for all the niceties of a normal topic branch, you may author commits, reset any changes which you decide are not valuable, push this branch to save your work, etc...\u003C\u002Fp\u003E\n\u003Ch1\u003EChecking Out From Worktree\u003C\u002Fh1\u003E\n\u003Cp\u003EAt this stage the worktree branch &quot;myrepo-pr-changes&quot; has all the commits necessary to comfort your code reviewers.\u003C\u002Fp\u003E\n\u003Cp\u003EIt is time to get these changes back into the topic branch.\u003C\u002Fp\u003E\n\u003Cp\u003EWe can diff the code between &quot;topic-branch&quot; and &quot;myrepo-pr-change&quot; worktree branch.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git diff --name-only topic-branch myrepo-pr-changes\u003C\u002Fspan\u003E\nbusinesslogic.go\nplumbing.go\nstore.go\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe diff shows that specific files have changed in order to appease our code reviewers.\u003C\u002Fp\u003E\n\u003Cp\u003EAn interactive rebase can get these changes into the correct commits by returning to the original repository directory.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E \u003Cspan class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ..\u002Fmyrepo        \u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-meta\"\u003E\n$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git rebase -i HEAD~2\u003C\u002Fspan\u003E\n\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ENext the interactive prompt is displayed\u003C\u002Fp\u003E\n\u003Cp\u003EBy specifying &quot;edit&quot; in one of our commits the changes present in the diff between &quot;topic-branch&quot; and &quot;myrepo-pr-changes&quot; can be checked out.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git rebase -i HEAD~2\u003C\u002Fspan\u003E\nStopped at 1cecb9d...  implement business logic\nYou can amend the commit now, with\n\n  git commit --amend\n\nOnce you are satisfied with your changes, run\n\n  git rebase --continue\n\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git checkout myrepo-pr-changes -- businesslogic.go\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git status\u003C\u002Fspan\u003E\ninteractive rebase in progress; onto abff991\nLast command done (1 command done):\n   edit 1cecb9d implement business logic\nNext command to do (1 remaining command):\n   pick 2d27894 implement plumbing\n  (use &quot;git rebase --edit-todo&quot; to view and edit)\nYou are currently editing a commit while rebasing branch &#x27;topic-branch&#x27; on &#x27;abff991&#x27;.\n  (use &quot;git commit --amend&quot; to amend the current commit)\n  (use &quot;git rebase --continue&quot; once you are satisfied with your changes)\n\nChanges to be committed:\n  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)\n    modified:   businesslogic.go\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git commit --amend\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E git rebase --\u003Cspan class=\"hljs-built_in\"\u003Econtinue\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\nSuccessfully rebased and updated refs\u002Fheads\u002Ftopic-branch.\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIn the above Git sequence the interactive rebase has paused on the &quot;implement business logic&quot; after choosing &quot;edit&quot;.\u003C\u002Fp\u003E\n\u003Cp\u003EThe file &quot;businesslogic.go&quot; from our &quot;myrepo-pr-changes&quot; branch is checked out immediately adding it to our staged commits.\u003C\u002Fp\u003E\n\u003Cp\u003EAn amendment is made to &quot;implement business logic&quot; commit, incorporating the changes in &quot;businesslogic.go&quot;.\u003C\u002Fp\u003E\n\u003Cp\u003EThe rebase is told to continue and subsequently finishes.\u003C\u002Fp\u003E\n\u003Ch1\u003EConclusion\u003C\u002Fh1\u003E\n\u003Cp\u003EBeing a bit of an eccentric about commit history, a well defined workflow for keeping things neat is attractive to me.\u003C\u002Fp\u003E\n\u003Cp\u003EThe use of worktrees, cross branch checkouts, and interactive rebases creates one that has worked well so far.\u003C\u002Fp\u003E\n\u003Cp\u003EI hope this post gets the gears turning for your own workflows.\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');</script><script src=/client/21d5f7fc0374dd879b15/main.js></script> 